<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碧蓝航线CD计算器-Alpha</title>
</head>

<body>
    <h1>碧蓝航线CD计算器-Alpha</h1>
    <a href="tech.html">科研数据配置</a>
    <div id="inputs">
        <input type="number" name="name1" id="name1">
        <input type="number" name="cd1" id="cd1">
        <input type="number" name="offset1" id="offset1">
        <br>
        <div id="buff"></div>
    </div>
    <div id="chart" style="width: auto; height: 600px;"></div>
</body>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"
    integrity="sha256-TI0rIaxop+pDlHNVI6kDCFvmpxNYUnVH/SMjknZ/W0Y=" crossorigin="anonymous"></script>
<script src="js/render.js"></script>
<script>
    const STORE_KEY = 'AzurLaneCDTool-CacheData';
    var data = localStorage.getItem(STORE_KEY);
    if (!data) {
        data = {};
    }
    var shipChartData = [{
        "name": "光辉",
        "type": "CV",
        "ts": {
            "type": "fixed",
            "offset": 20.08 + 2,
            "cd": 20.08,
            "duration": 2
        }
    }];
    var buffChartData = [];

    var techData = data.techData || {};
    var buffData = {};
    async function loadBuffData() {
        var resp = await fetch('data/buff.json');
        buffData = await resp.json();
        var buffDom = document.getElementById('buff');
        for (var key in buffData) {
            var item = buffData[key];
            buffDom.innerHTML += `<label for="${key}">${item.name}</label>`;
            buffDom.innerHTML += `<input type="checkbox" name="${key}" id="${key}" onchange="updateBuffData(this)" />`;
        }
    }
    loadBuffData();

    function updateBuffData(obj) {
        if (obj.checked) {
            var item = buffData[obj.id]
            console.log(item);
            if (!!item.exclude) {
                for (var key of item.exclude) {
                    var eitem = document.getElementById(key);
                    eitem.checked = false;
                }
            }
        }
        buffChartData = [];
        for (var key in buffData) {
            if (document.getElementById(key).checked) {
                buffChartData.push(buffData[key]);
            }
        }
        window.setChartOption(shipChartData, buffChartData, { maxDuration: 180 });
    }

    window.setChartOption(shipChartData, buffChartData, { maxDuration: 180 });
</script>

</html>